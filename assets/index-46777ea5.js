var b=Object.defineProperty;var R=(i,n,t)=>n in i?b(i,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[n]=t;var l=(i,n,t)=>(R(i,typeof n!="symbol"?n+"":n,t),t);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(e){if(e.ep)return;e.ep=!0;const o=t(e);fetch(e.href,o)}})();function x(i,n){const s=[];let e=n;if(n){let o=0,r=0;for(let c=0;c<=e.length;c++)i.measureText(e.slice(o,c)).width>130&&(s.push(e.slice(o,c)),o=c,r=c);let h=e.slice(r,e.length);s.push(h),e=h}return s}let f=[[134,166,157],[242,178,99],[242,198,194],[242,133,133],[137,217,157],[22,72,115]];function z(){f=[[134,166,157],[242,178,99],[242,198,194],[242,133,133],[137,217,157],[22,72,115]]}function C(i=null){if(!i){let n=f[Math.floor(Math.random()*f.length)];return f=f.filter(t=>String(t)!==String(n)),n}return f=f.filter(n=>String(n)!==String(i)),i}class X{constructor(n,t,s,e,o,r,h,c,u,p){l(this,"id");l(this,"startX");l(this,"endX");l(this,"startY");l(this,"endY");l(this,"width");l(this,"height");l(this,"color");l(this,"borderRadius");l(this,"contextText");l(this,"contextTextFontSize");l(this,"activeInput");l(this,"getInfoRectangle",()=>({startX:this.startX,endX:this.endX,startY:this.startY,endY:this.endY,width:this.width,height:this.height,color:this.color,contextText:this.contextText}));l(this,"draw",(n,t)=>{let s=n.getContext("2d");if(s.beginPath(),s.fillStyle=`rgb(${this.color},${t})`,s.moveTo(this.startX+this.borderRadius,this.startY),s.arcTo(this.startX+this.width,this.startY,this.startX+this.width,this.startY+this.height,this.borderRadius),s.arcTo(this.startX+this.width,this.startY+this.height,this.startX,this.startY+this.height,this.borderRadius),s.arcTo(this.startX,this.startY+this.height,this.startX,this.startY,this.borderRadius),s.arcTo(this.startX,this.startY,this.startX+this.width,this.startY,this.borderRadius),s.fill(),this.contextText&&(s.font=`${this.contextTextFontSize} Helvetica`,s.fillStyle="white",x(s,this.contextText).length>0)){let e=this.startY+45;for(let o of x(s,this.contextText))s.fillText(o,this.startX+15,e),e+=18}s.closePath()});l(this,"drawText",n=>{let t=n.getContext("2d");if(this.contextText&&(t.font=`${this.contextTextFontSize} Helvetica`,t.fillStyle="white",x(t,this.contextText).length>0)){let s=this.startY+45;console.log(x(t,this.contextText));for(let e of x(t,this.contextText))t.fillText(e,this.startX+15,s),s+=18}});l(this,"updated",(n,t)=>{this.startX=n-80,this.endX=n+80,this.startY=t-90,this.endY=t+90,this.width=160,this.height=180,this.color=this.color});l(this,"wipeOf",n=>{n.getContext("2d").clearRect(this.startX,this.startY,160,180)});l(this,"insertText",n=>{this.contextText=n.value,this.contextTextFontSize=n.style.fontSize,n.focus()});l(this,"removeText",(n,t)=>{t.value=this.contextText,this.contextText="",this.wipeOf(n),this.draw(n,1)});this.id=s,this.startX=h??n-80,this.endX=c??n+80,this.startY=u??t-90,this.endY=p??t+90,this.width=160,this.height=180,this.color=C(r),this.borderRadius=30,this.contextText=e??"",this.contextTextFontSize=o??"",this.activeInput=!1}}function T(i,n,t){let s={id:0,flag:!1};return i.forEach(e=>{e.startX<n&&e.endX>n&&e.startY<t&&e.endY>t&&(s.flag=!0,s.id=e.id)}),s}function S(i,n){i.width=window.innerWidth,i.height=window.innerHeight,n.forEach(t=>t.draw(i,1))}function g(i,n,t){i.forEach(s=>s.draw(n,t))}function F({startX:i,startY:n,width:t,height:s,color:e,contextText:o}){const r=document.createElement("textarea");return r.id="text-input",r.style.left=`${i+10}px`,r.style.top=`${n+90}px`,r.style.backgroundColor=`${e}`,r.style.position="absolute",r.style.maxWidth=`${t-30}px`,r.style.minWidth=`${t-30}px`,r.style.maxHeight=`${s-50}px`,r.style.height=`${s-50}px`,r.style.outline="none",r.style.resize="none",r.style.color="white",r.style.textAlign="center",r.style.fontFamily="Helvetica",r.style.overflow="hidden",r.cols=13,r.style.lineHeight="18px",r.value=o,r}function k(i,n){const t=i.findIndex(e=>e.id===n);if(t===-1||t===i.length-1)return i;const s=i[t];for(let e=t;e<i.length-1;e++)i[e]=i[e+1];return i[i.length-1]=s,i}let d=[];function O(){d=[]}function v(i){return d.find(t=>t.id===i)}function $(i){let n=!1,t;S(i,d),window.addEventListener("resize",()=>S(i,d));function s(e){let o=v(t.id);o.wipeOf(i),o.updated(e.offsetX,e.offsetY),d.filter(r=>r.id!==o.id).forEach(r=>r.draw(i,1)),o.draw(i,.5)}i.addEventListener("mousedown",e=>{t=T(d,e.offsetX,e.offsetY),t.flag?(i.addEventListener("mousemove",s),n=!0,g(d,i,1)):console.log("Вы находитесь не на элементе")}),i.addEventListener("mouseup",e=>{var o;if(e.preventDefault(),k(d,t.id),g(d,i,1),(o=v(t.id))==null||o.draw(i,1),d.length<6&&!T(d,e.offsetX,e.offsetY).flag&&!n){let r=new X(e.offsetX,e.offsetY,d.length+1);d.push(r),r.draw(i,1)}i.removeEventListener("mousemove",s),n=!1}),i.addEventListener("dblclick",()=>{const e=document.querySelector(".canvas-сontainer");let o=v(t.id);o.activeInput=!0;const r=F(o.getInfoRectangle());if(o.removeText(i,r),g(d,i,1),o.draw(i,1),o&&d.length<=6){let h=function(){o.insertText(r),o.draw(i,1),r.remove(),document.removeEventListener("click",h)};r.addEventListener("input",()=>{let c=r.value.length;for(r.style.fontSize=Math.max(18,18+c<=18?c:18)+"px";r.scrollHeight>r.clientHeight;){let u=parseFloat(window.getComputedStyle(r,null).getPropertyValue("font-size"));r.style.fontSize=u-1+"px"}}),document.addEventListener("click",h),r.addEventListener("keydown",c=>{c.key==="Enter"&&(o.insertText(r),o.draw(i,1),r.remove())}),e.appendChild(r),o.insertText(r)}})}function q(i){return i.map(t=>({id:t.id,startX:t.startX,endX:t.endX,startY:t.startY,endY:t.endY,color:t.color,text:t.contextText,textSize:t.contextTextFontSize}))}function H(i,n,t){i.addEventListener("click",()=>{if(i.setAttribute("download","text.json"),d.length>0){const s=q(d),e=JSON.stringify(s),o=new Blob([e],{type:"aplication/json"});i.href=URL.createObjectURL(o)}else alert("Нет элементов которые можно сохранить")}),n.addEventListener("click",()=>{z();let s=document.querySelector(".link-download");s.addEventListener("click",e);function e(){let o=document.querySelector(".fileUpload");async function r(h){let u=h.target.files[0];async function p(a){return new Promise((L,E)=>{const w=new FileReader;w.onload=y=>{var m;return L(JSON.parse((m=y.target)==null?void 0:m.result))},w.onerror=y=>E(y),w.readAsText(a)})}let Y=(await p(u)).map(a=>new X(a.x,a.y,a.id,a.text,a.textSize,a.color,a.startX,a.endX,a.startY,a.endY));d.forEach(a=>a.wipeOf(t)),O(),Y.forEach(a=>{d.push(a)}),g(d,t,1),o.value="",o.removeEventListener("change",r),s.removeEventListener("click",e)}o.addEventListener("change",r)}})}document.querySelector("#app").innerHTML=`
  <div>
  <div class="notepad-container">
  <header class="header-container">
  <div class="header">
  <div class="header-empty"></div>
  <div class="header-title"><h1>Canvas Notepad</h1></div>
  <div class="header-links">
  <a class="link-save">
  <img src="save.svg"/>
  </a>
  <div class="download-container">
  <a class="link-download">
  <input type="file" id="file" class="fileUpload"></input>
  <label for="file">
  <img src="download.svg"/>
  </label>
  </a>
  </div>
  </div>
  </div>
  </header>
  <div class="canvas-сontainer">
  <canvas id="canvas"></canvas>
  </div>
  </div>
  </div>
`;$(document.querySelector("canvas"));H(document.querySelector(".link-save"),document.querySelector(".download-container"),document.querySelector("canvas"));
