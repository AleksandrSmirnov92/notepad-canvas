var E=Object.defineProperty;var b=(i,n,t)=>n in i?E(i,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[n]=t;var l=(i,n,t)=>(b(i,typeof n!="symbol"?n+"":n,t),t);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(e){if(e.ep)return;e.ep=!0;const o=t(e);fetch(e.href,o)}})();function x(i,n){const s=[];let e=n;if(n){let o=0,r=0;for(let c=0;c<=e.length;c++)i.measureText(e.slice(o,c)).width>130&&(s.push(e.slice(o,c)),o=c,r=c);let h=e.slice(r,e.length-1);s.push(h),e=h}return s}let f=[[134,166,157],[242,178,99],[242,198,194],[242,133,133],[137,217,157],[22,72,115]];function R(){f=[[134,166,157],[242,178,99],[242,198,194],[242,133,133],[137,217,157],[22,72,115]]}function z(i=null){if(!i){let n=f[Math.floor(Math.random()*f.length)];return f=f.filter(t=>String(t)!==String(n)),n}return f=f.filter(n=>String(n)!==String(i)),i}class S{constructor(n,t,s,e,o,r,h,c,u,_){l(this,"id");l(this,"_startX");l(this,"_endX");l(this,"_startY");l(this,"_endY");l(this,"_width");l(this,"_height");l(this,"_color");l(this,"borderRadius");l(this,"contextText");l(this,"contextTextFontSize");l(this,"activeInput");l(this,"getInfoRectangle",()=>({startX:this._startX,endX:this._endX,startY:this._startY,endY:this._endY,width:this._width,height:this._height,color:this._color,contextText:this.contextText}));l(this,"draw",(n,t)=>{let s=n.getContext("2d");if(s.beginPath(),s.fillStyle=`rgb(${this._color},${t})`,s.moveTo(this._startX+this.borderRadius,this._startY),s.arcTo(this._startX+this._width,this._startY,this._startX+this._width,this._startY+this._height,this.borderRadius),s.arcTo(this._startX+this._width,this._startY+this._height,this._startX,this._startY+this._height,this.borderRadius),s.arcTo(this._startX,this._startY+this._height,this._startX,this._startY,this.borderRadius),s.arcTo(this._startX,this._startY,this._startX+this._width,this._startY,this.borderRadius),s.fill(),this.contextText&&(s.font=`${this.contextTextFontSize} Helvetica`,s.fillStyle="white",x(s,this.contextText).length>0)){let e=this._startY+45;for(let o of x(s,this.contextText))s.fillText(o,this._startX+15,e),e+=18}s.closePath()});l(this,"drawText",n=>{let t=n.getContext("2d");if(this.contextText&&(t.font=`${this.contextTextFontSize} Helvetica`,t.fillStyle="white",x(t,this.contextText).length>0)){let s=this._startY+45;console.log(x(t,this.contextText));for(let e of x(t,this.contextText))t.fillText(e,this._startX+15,s),s+=18}});l(this,"updated",(n,t)=>{this._startX=n-80,this._endX=n+80,this._startY=t-90,this._endY=t+90,this._width=160,this._height=180,this._color=this._color});l(this,"wipeOf",n=>{n.getContext("2d").clearRect(this._startX,this._startY,160,180)});l(this,"insertText",n=>{this.contextText=n.value,this.contextTextFontSize=n.style.fontSize,n.focus()});l(this,"removeText",(n,t)=>{t.value=this.contextText,this.contextText="",this.wipeOf(n),this.draw(n,1)});this.id=s,this._startX=h??n-80,this._endX=c??n+80,this._startY=u??t-90,this._endY=_??t+90,this._width=160,this._height=180,this._color=z(r),this.borderRadius=30,this.contextText=e??"",this.contextTextFontSize=o??"",this.activeInput=!1}}function m(i,n,t){let s={id:0,flag:!1};return i.forEach(e=>{e._startX<n&&e._endX>n&&e._startY<t&&e._endY>t&&(s.flag=!0,s.id=e.id)}),s}function T(i,n){i.width=window.innerWidth,i.height=window.innerHeight,n.forEach(t=>t.draw(i,1))}function g(i,n,t){i.forEach(s=>s.draw(n,t))}function C({startX:i,startY:n,width:t,height:s,color:e,contextText:o}){const r=document.createElement("textarea");return r.id="text-input",r.style.left=`${i+10}px`,r.style.top=`${n+90}px`,r.style.backgroundColor=`${e}`,r.style.position="absolute",r.style.maxWidth=`${t-30}px`,r.style.minWidth=`${t-30}px`,r.style.maxHeight=`${s-50}px`,r.style.height=`${s-50}px`,r.style.outline="none",r.style.resize="none",r.style.color="white",r.style.textAlign="center",r.style.fontFamily="Helvetica",r.style.overflow="hidden",r.cols=13,r.style.lineHeight="18px",r.value=o,r}function F(i,n){const t=i.findIndex(e=>e.id===n);if(t===-1||t===i.length-1)return i;const s=i[t];for(let e=t;e<i.length-1;e++)i[e]=i[e+1];return i[i.length-1]=s,i}let d=[];function k(){d=[]}function y(i){return d.find(t=>t.id===i)}function O(i){let n=!1,t;T(i,d),window.addEventListener("resize",()=>T(i,d));function s(e){let o=y(t.id);o.wipeOf(i),o.updated(e.offsetX,e.offsetY),d.filter(r=>r.id!==o.id).forEach(r=>r.draw(i,1)),o.draw(i,.5)}i.addEventListener("mousedown",e=>{t=m(d,e.offsetX,e.offsetY),t.flag?(i.addEventListener("mousemove",s),n=!0,g(d,i,1)):console.log("Вы находитесь не на элементе")}),i.addEventListener("mouseup",e=>{var o;if(e.preventDefault(),F(d,t.id),g(d,i,1),(o=y(t.id))==null||o.draw(i,1),d.length<6&&!m(d,e.offsetX,e.offsetY).flag&&!n){let r=new S(e.offsetX,e.offsetY,d.length+1);d.push(r),r.draw(i,1)}i.removeEventListener("mousemove",s),n=!1}),i.addEventListener("dblclick",()=>{const e=document.querySelector(".canvas-сontainer");let o=y(t.id);o.activeInput=!0;const r=C(o.getInfoRectangle());if(o.removeText(i,r),g(d,i,1),o.draw(i,1),o&&d.length<=6){let h=function(){o.insertText(r),o.draw(i,1),r.remove(),document.removeEventListener("click",h)};r.addEventListener("input",()=>{let c=r.value.length;for(r.style.fontSize=Math.max(18,18+c<=18?c:18)+"px";r.scrollHeight>r.clientHeight;){let u=parseFloat(window.getComputedStyle(r,null).getPropertyValue("font-size"));r.style.fontSize=u-1+"px"}}),document.addEventListener("click",h),r.addEventListener("keydown",c=>{c.key==="Enter"&&(o.insertText(r),o.draw(i,1),r.remove())}),e.appendChild(r),o.insertText(r)}})}function $(i){return i.map(t=>({id:t.id,startX:t._startX,endX:t._endX,startY:t._startY,endY:t._endY,color:t._color,text:t.contextText,textSize:t.contextTextFontSize}))}function q(i,n,t){i.addEventListener("click",()=>{if(i.setAttribute("download","text.json"),d.length>0){const s=$(d),e=JSON.stringify(s),o=new Blob([e],{type:"aplication/json"});i.href=URL.createObjectURL(o)}else alert("Нет элементов которые можно сохранить")}),n.addEventListener("click",()=>{R();let s=document.querySelector(".link-download");s.addEventListener("click",e);function e(){let o=document.querySelector(".fileUpload");async function r(h){let u=h.target.files[0];async function _(a){return new Promise((Y,L)=>{const p=new FileReader;p.onload=w=>{var v;return Y(JSON.parse((v=w.target)==null?void 0:v.result))},p.onerror=w=>L(w),p.readAsText(a)})}let X=(await _(u)).map(a=>new S(a.x,a.y,a.id,a.text,a.textSize,a.color,a.startX,a.endX,a.startY,a.endY));d.forEach(a=>a.wipeOf(t)),k(),X.forEach(a=>{d.push(a)}),g(d,t,1),o.value="",o.removeEventListener("change",r),s.removeEventListener("click",e)}o.addEventListener("change",r)}})}document.querySelector("#app").innerHTML=`
  <div>
  <div class="notepad-container">
  <header class="header-container">
  <div class="header">
  <div class="header-empty"></div>
  <div class="header-title"><h1>Canvas Notepad</h1></div>
  <div class="header-links">
  <a class="link-save">
  <img src="save.svg"/>
  </a>
  <div class="download-container">
  <a class="link-download">
  <input type="file" id="file" class="fileUpload"></input>
  <label for="file">
  <img src="download.svg"/>
  </label>
  </a>
  </div>
  </div>
  </div>
  </header>
  <div class="canvas-сontainer">
  <canvas id="canvas"></canvas>
  </div>
  </div>
  </div>
`;O(document.querySelector("canvas"));q(document.querySelector(".link-save"),document.querySelector(".download-container"),document.querySelector("canvas"));
